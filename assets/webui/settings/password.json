{"title":"Change Password","scrolling":true,"init":"$('body').addClass('textured');\n$('#subheader').text(OF.page.title);\nvar isFormValid = function() {\n  var valid = true; \n  $(':input').each(function(index,field) {\n    if (field.value.length == 0) {\n      OF.alert('Missing Data', 'Please fill out all fields in order to change your password.');\n      valid = false;\n      return false;\n    }\n  });\n  return valid;\n}\n\n$('#change_password_form').submit(function() {\n  if ($(this).isLoading()) return false;\n  \n  var oldPass = $('#password').val();\n  var newPass = $('#user_http_basic_credential_attributes_password').val();\n  var newPassConfirm = $('#user_http_basic_credential_attributes_password_confirmation').val();\n  \n  if ( isFormValid() ) {\n    $(this).isLoading(true);\n    OF.api.request('/xp/users/'+ OF.user.id, {\n      method: 'PUT',\n      loader: '#submit',\n      params: {\n        password: $('#password').val(),\n        user: {\n          http_basic_credential_attributes: {\n            password:               $('#user_http_basic_credential_attributes_password').val(),\n            password_confirmation:  $('#user_http_basic_credential_attributes_password_confirmation').val(),\n          }\n        }\n      },\n      success: function() {\n        OF.goBack();\n        OF.alert('Success', \"You have changed your password.\");\n      },\n      failure: function(data) {\n        if (data.exception) {\n          if (data.exception['class'] == 'PlayerNotAuthenticated') {\n            OF.alert('Error', 'Your curent password was not correct.');\n          } else {\n            OF.alert('Error', data.exception.message);\n          }\n        } else {\n          OF.alert('Error', 'Sorry, we had an error processing this request.  Try again in a few moments.');\n        }\n      },\n      complete: function() {\n        $('#change_password_form').isLoading(false);\n      }\n    });\n  }\n  \n  return false;\n});\n\n$('#submit').touch(function() {\n  if ( isFormValid() ) $('#change_password_form').submit();\n});","html":"<div id='settings'>\n<div id='header'>Settings</div>\n<div id='subheader'></div>\n<form id='change_password_form'>\n<div class='input_field'>\n<label>Current Password</label>\n<input id='password' name='password' type='password'>\n</div>\n<div class='input_field'>\n<label>New Password</label>\n<input id='user_http_basic_credential_attributes_password' name='user[http_basic_credential_attributes][password]' type='password'>\n</div>\n<div class='input_field'>\n<label>Confirm Password</label>\n<input id='user_http_basic_credential_attributes_password_confirmation' name='user[http_basic_credential_attributes][password_confirmation]' type='password'>\n</div>\n<div class='button' id='submit'>Okay</div>\n</form>\n\n</div>\n"}